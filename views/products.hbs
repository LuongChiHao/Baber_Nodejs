<nav class="navbar navbar-expand-sm navbar-dark fixed-top">
    <!-- Brand/logo -->
    <a class="navbar-brand" href="/trangchu">
        <img src="./images/logo-footer.png" alt="logo" style="width:90%;">
    </a>

    <!-- Links -->
    <ul class="navbar-nav">
        <li class="nav-item">
            <a class="nav-link" href="/lichhen"> <span class="fas fa-calendar"></span> Lịch hẹn</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="/khachhang"><span class="fas fa-id-card"></span> Khách hàng</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="/thongke"><span class="fas fa-donate"></span> Thống kê</a>
        </li>

        <li class="nav-item">
            <a class="nav-link" href="/toc"><span class="fas fa-folder-open"></span> Quản lý tóc</a>
        </li>

        <li class="nav-item active">
            <a class="nav-link" href="/products"><span class="fas fa-paperclip"></span> Quản lý sản phẩm</a>
        </li>

        <li class="nav-item">
            <a class="nav-link" href="/logout"><span class="fas fa-user-secret"></span> Đăng xuất</a>
        </li>
    </ul>


</nav>

<div class="products">
<div class="container-fluid mt-5 pt-5">
    <div class="container">
      <h1 class="text-light text-center pt-5 pb-5">QUẢN LÝ SẢN PHẨM</h1>

      <div class="row">
        <div class="col-md-3"></div>
        <div class="col-md-6 creat-form">
          <form action="/action_page.php" class="p-4">
            <h4 class="text-light display-4 mb-3"><small>Tạo mới sản phẩm</small></h4>
            <div class="form-group">
              <label for="namesp">Tên sản phẩm: </label>
              <input name="name" type="text" class="form-control" placeholder="Enter tên sản phẩm" id="namesp">
            </div>
            <div class="form-group">
              <label for="costsp">Giá sản phẩm:</label>
              <input name="cost" type="number" class="form-control" placeholder="Enter giá sản phẩm" id="costsp">
            </div>

            <div class="form-group">
              <label for="datesp">Ngày nhập: </label>
              <input name="date" class=" form-control" type="date" id="datesp">
            </div>

            <div class="form-group">
              <label for="brandsp">Nhãn hàng: </label>
              <select name="brand" class="form-control" style="padding:0 0.75rem">
                {{#each brand}}
                        <option value="{{this.id}}">{{this.name}}</option>
                {{/each}}
              </select>
            </div>
            <button type="submit" class="btn btn-primary btntoc">Tạo</button>
          </form>
        </div>
        <div class="col-md-3"></div>
      </div>
    </div>
    
    <div class="row">
        <div class="col-md-2">

        </div>

        <div class="col-md-8">
            <table class="table table-dark table-striped table-hover">
                 <input class="form-control" id="myInput" type="text" placeholder="Search..">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>name</th>
                        <th>cost</th>
                        <th>date</th>
                        <th>brand</th>
                        <th>Option</th>
                    </tr>
                </thead>
                <tbody id="myTable">
                    {{#each products}}
                    <tr>
                        <td>{{this.id}}</td>
                        <td>{{this.name}}</td>
                        <td>{{this.cost}}</td>
                        <td class="center">{{formatDate this.date}}</td>
                        <td>{{getBrandName this.brand ../brand}}</td>
                        <td>
                            <button class="btn btn-link text-light" onclick="onEdit({{this.id}})" >Edit</button>
                            <button class="btn btn-link text-light" onclick="onDelete({{this.id}})" >Delete</button>
                        </td>
                    </tr>
                    {{/each}}
                </tbody>
            </table>
        </div>

        <div class="col-md-2"></div>

    </div>
</div>
</div>
<!-- Script table sp -->
<script>
  $(document).ready(function () {
    $("#myInput").on("keyup", function () {
      var value = $(this).val().toLowerCase();
      $("#myTable tr").filter(function () {
        $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
      });
    });
  });
</script>
<!-- End table sp -->

{{!-- edit --}}
<script>
    const onDelete = async (id) =>{
        const url = 'http://localhost:3000/products/delete/'+id;
        const option = {
            method: 'delete',
            header: {
                'Content-Type': 'application/json'
            }
        }
        try
        {
            await fetchAPI(url, option);
            window.location.href="/products";
        }
        catch(e)
        {
            console.log('Delete err: ',e)
        }
    }

    const fetchAPI = async (url, option) =>{
        const res = await fetch(url, option)
        return res.json();
    }

    const onEdit = id => {
        window.location.href="/products/edit/"+ id;
    }
</script>